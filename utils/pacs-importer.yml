apiVersion: batch/v1
kind: Job
metadata:
  name: pacs-importer
spec:
  template:
    spec:
      containers:
      - name: pacs-importer
        image: osirixfoundation/kheops-pacs-importer:v0.9.1-google-branch
        imagePullPolicy: Always
        env:
        - name: IMPORTER_TOKEN
          value: $IMPORTER_TOKEN
        envFrom:
        - configMapRef:
            name: kheops-config
        - configMapRef:
            name: kheops-config-common
        volumeMounts:
        - name: secrets
          mountPath: "/run/secrets/privkey.pem"
          subPath: privkey.pem
        - name: importer-token-secret
          mountPath: "/run/secrets/importer_token"
          subPath: importer_token
      restartPolicy: Never
      volumes:
        - name: secrets
          secret:
            secretName: kheops.secrets
            items:
            - key: cloudhealth_service_account_private_key
              path: privkey.pem
        - name: importer-token-secret
          secret:
            secretName: importer-token-secret
            items:
            - key: importer_token
              path: importer_token
      restartPolicy: Never
  backoffLimit: 4
