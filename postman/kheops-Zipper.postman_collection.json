{
	"info": {
		"_postman_id": "ff4d2e08-7ba0-49a4-9af5-a58ea30c90c0",
		"name": "kheops-Zipper",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "create user1-create",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 201\"] = responseCode.code === 201;",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"pm.environment.set(\"access_token_user1\", jsonObject.access_token);"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjEifQ.eyJhdWQiOiJhdXRob3JpemF0aW9uLmtoZW9wcy5vbmxpbmUiLCJzdWIiOiIxMjM0NTY3ODkiLCJlbWFpbCI6InRvdG9AZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImV4cCI6MjUyMjk0MzU3MiwiaXNzIjoiYXV0aG9yaXphdGlvbi5raGVvcHMub25saW5lIiwiaWF0IjoxNTIyOTM5OTcyfQ.916Xn1BnUwdhOvuWErWWOh_AkYXeS36mVRTP06VWsVA",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/token",
					"host": [
						"{{URL}}"
					],
					"path": [
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "STOW RS inside inbox user 1",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "7524252c-94ee-4cd1-8780-15785472765a",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "multipart/related; type=\"application/dicom\"; boundary=myboundary"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					}
				],
				"body": {
					"mode": "file",
					"file": {}
				},
				"url": {
					"raw": "{{URL}}/studies",
					"host": [
						"{{URL}}"
					],
					"path": [
						"studies"
					]
				}
			},
			"response": []
		},
		{
			"name": "user1 get studies list-1studie",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "a5055b06-d516-4117-b4f9-60329a2c6126",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"tests[\"Not empty response []\"] = responseBody != \"[]\"",
							"",
							"pm.environment.set(\"tempDicomData\", responseBody);"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "fbf4e0e6-dc5f-4d19-8857-6ec861ef624e",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					},
					{
						"key": "Accept",
						"value": "application/dicom+json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{URL}}/studies",
					"host": [
						"{{URL}}"
					],
					"path": [
						"studies"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a capability tokens user1-OK",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "45c0c8f5-b3d4-4cec-9f0f-d39d256dd371",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 201\"] = responseCode.code === 201;",
							"",
							"tests[\"Not empty response []\"] = responseBody != \"[]\"",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"title\");",
							"tests[\"Revoked is false\"] = jsonObject.revoked === false;",
							"",
							"",
							"pm.environment.set(\"secret_capability_token\", jsonObject.secret);"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "c99d50c0-13a7-4b5a-a1f7-2389cbc16232",
						"exec": [
							"pm.environment.set(\"description\", \"some description\");"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					},
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "title",
							"value": "{{description}}",
							"type": "text"
						},
						{
							"key": "scope_type",
							"value": "user",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Download zip stream",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "46b155ae-da60-4c38-974f-fd99e1b9add8",
						"type": "text/javascript",
						"exec": [
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"tests[\"Content-Type = application/zip\"] = \"application/zip\" === postman.getResponseHeader(\"Content-Type\");"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{secret_capability_token}}"
					}
				],
				"body": {},
				"url": {
					"raw": "{{URL}}/wado?studyUID={{study_UID}}&requestType=ZIP",
					"host": [
						"{{URL}}"
					],
					"path": [
						"wado"
					],
					"query": [
						{
							"key": "studyUID",
							"value": "{{study_UID}}"
						},
						{
							"key": "requestType",
							"value": "ZIP"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Download zip stream link",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "46b155ae-da60-4c38-974f-fd99e1b9add8",
						"type": "text/javascript",
						"exec": [
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"tests[\"Content-Type = application/zip\"] = \"application/zip\" === postman.getResponseHeader(\"Content-Type\");"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{secret_capability_token}}"
					}
				],
				"body": {},
				"url": {
					"raw": "{{URL}}/link/{{secret_capability_token}}/wado?studyUID={{study_UID}}&requestType=ZIP",
					"host": [
						"{{URL}}"
					],
					"path": [
						"link",
						"{{secret_capability_token}}",
						"wado"
					],
					"query": [
						{
							"key": "studyUID",
							"value": "{{study_UID}}"
						},
						{
							"key": "requestType",
							"value": "ZIP"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Download zip stream Bad study UID",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "0248e8c8-9462-4bce-b7da-d191e4afb22f",
						"type": "text/javascript",
						"exec": [
							"tests[\"Status code is 404\"] = responseCode.code === 404;",
							""
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{secret_capability_token}}"
					}
				],
				"body": {},
				"url": {
					"raw": "{{URL}}/wado?studyUID={{study_UID}}11&requestType=ZIP",
					"host": [
						"{{URL}}"
					],
					"path": [
						"wado"
					],
					"query": [
						{
							"key": "studyUID",
							"value": "{{study_UID}}11"
						},
						{
							"key": "requestType",
							"value": "ZIP"
						},
						{
							"key": null,
							"value": null
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Download zip stream Bad token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "8097f253-9943-476c-b05e-fdb97addd36e",
						"type": "text/javascript",
						"exec": [
							"tests[\"Status code is 401\"] = responseCode.code === 401;"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"body": {},
				"url": {
					"raw": "{{URL}}/link/12345678/wado?studyUID={{study_UID}}&requestType=ZIP",
					"host": [
						"{{URL}}"
					],
					"path": [
						"link",
						"12345678",
						"wado"
					],
					"query": [
						{
							"key": "studyUID",
							"value": "{{study_UID}}"
						},
						{
							"key": "requestType",
							"value": "ZIP"
						},
						{
							"key": null,
							"value": null
						}
					]
				}
			},
			"response": []
		}
	]
}