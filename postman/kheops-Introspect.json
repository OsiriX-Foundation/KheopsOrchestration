{
  "info": {
    "_postman_id": "a8d38f9f-5ec4-4acd-9560-c22a5c31a361",
    "name": "kheops-Introspect",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "name": "Initialisation",
      "item": [
        {
          "name": "user1 introspect",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
                "exec": [
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Active = true\"] = jsonObject.active === true;",
                  "tests[\"Scope = read write\"] = jsonObject.scope.includes(\"read\") && jsonObject.scope.includes(\"write\");",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "c2e5a87c-6dca-41e9-9c83-04683d00df54",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "basic",
              "basic": {
                "password": "dicomwebproxyclientpassword",
                "username": "DICOMWebProxy"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "type": "text",
                  "value": "{{user1_token}}"
                }
              ]
            },
            "url": "{{URL}}/token/introspect"
          },
          "response": []
        }
      ],
      "_postman_id": "e612aef8-9ba7-4147-8b17-7f59e9f52974",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "eedf2349-2443-497c-bed4-070bbdceb9a9",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "6ca5f33e-5df8-441f-8fe1-d3ad6c95e633",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "name": "Introspect capabilities tokens from album",
      "item": [
        {
          "name": "Create an album(1)-OK",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "c09cfdaa-aa57-499c-a23c-8e26fa376e1e",
                "exec": [
                  "tests[\"Status code is 201\"] = responseCode.code === 201;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "pm.environment.set(\"album_id_1\", jsonObject.album_id);",
                  "",
                  "tests[\"album_id\"] = jsonObject.album_id == pm.environment.get(\"album_id_1\");",
                  "",
                  "tests[\"name\"] = jsonObject.name == \"name 1\"",
                  "",
                  "tests[\"description\"] = jsonObject.description == \"description 1\"",
                  "",
                  "tests[\"is_favorite\"] = jsonObject.is_favorite == false",
                  "",
                  "tests[\"number_of_users\"] = jsonObject.number_of_users == 1",
                  "",
                  "tests[\"number_of_comments\"] = jsonObject.number_of_comments == 0",
                  "",
                  "tests[\"number_of_studies\"] = jsonObject.number_of_studies == 0",
                  "",
                  "tests[\"add_user\"] = jsonObject.add_user == false",
                  "",
                  "tests[\"download_series\"] = jsonObject.download_series == true",
                  "",
                  "tests[\"send_series\"] = jsonObject.send_series == false",
                  "",
                  "tests[\"delete_series\"] = jsonObject.delete_series == false",
                  "",
                  "tests[\"add_series\"] = jsonObject.add_series == true",
                  "",
                  "tests[\"write_comments\"] = jsonObject.write_comments == true",
                  "",
                  "tests[\"notification_new_series\"] = jsonObject.notification_new_series == true",
                  "",
                  "tests[\"notification_new_comment\"] = jsonObject.notification_new_comment == true",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9779808a-2ba5-42f3-a7a1-2d91cb976010",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "0d1d9b84-a8b1-4c6f-9982-b8cf4485625a",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": {
                "token": "{{user1_token}}"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "sendSeries",
                  "value": "false",
                  "type": "text"
                },
                {
                  "key": "name",
                  "value": "name 1",
                  "type": "text"
                },
                {
                  "key": "description",
                  "value": "description 1",
                  "type": "text"
                }
              ]
            },
            "url": "{{URL}}/albums"
          },
          "response": []
        },
        {
          "name": "Create a capability token write",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "31a1a60d-9293-4452-8e38-5f54a7c164db",
                "exec": [
                  "// ensure healthy response code",
                  "tests[\"Status code is 201\"] = responseCode.code === 201;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;",
                  "",
                  "tests[\"Not empty response []\"] = responseBody != \"[]\"",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"title\");",
                  "tests[\"Revoked is false\"] = jsonObject.revoked === false;",
                  "",
                  "pm.environment.set(\"secret_capability_token_write\", jsonObject.secret);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "c99d50c0-13a7-4b5a-a1f7-2389cbc16232",
                "exec": [
                  "pm.environment.set(\"description\", \"some description\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "565f6d06-ce2e-4907-a3b7-54a60f6c55bd",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": {
                "token": "{{user1_token}}"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "title",
                  "type": "text",
                  "value": "{{description}}"
                },
                {
                  "key": "scope_type",
                  "type": "text",
                  "value": "album"
                },
                {
                  "key": "album",
                  "type": "text",
                  "value": "{{album_id_1}}"
                },
                {
                  "key": "read_permission",
                  "type": "text",
                  "value": "false"
                },
                {
                  "key": "write_permission",
                  "type": "text",
                  "value": "true"
                },
                {
                  "key": "appropriate_permission",
                  "type": "text",
                  "value": "false"
                },
                {
                  "key": "download_permission",
                  "type": "text",
                  "value": "false"
                }
              ]
            },
            "url": "{{URL}}/capabilities"
          },
          "response": []
        },
        {
          "name": "capability token write introspect",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
                "exec": [
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Active = true\"] = jsonObject.active === true;",
                  "tests[\"Scope = write\"] = jsonObject.scope.includes(\"read\") == false && jsonObject.scope.includes(\"write\");",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "1557b24c-baa9-415c-a2e0-b18130045824",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "basic",
              "basic": {
                "password": "dicomwebproxyclientpassword",
                "username": "DICOMWebProxy"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "type": "text",
                  "value": "{{secret_capability_token_write}}"
                }
              ]
            },
            "url": "{{URL}}/token/introspect"
          },
          "response": []
        },
        {
          "name": "Create a capability token read",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "31a1a60d-9293-4452-8e38-5f54a7c164db",
                "exec": [
                  "// ensure healthy response code",
                  "tests[\"Status code is 201\"] = responseCode.code === 201;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;",
                  "",
                  "tests[\"Not empty response []\"] = responseBody != \"[]\"",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"title\");",
                  "tests[\"Revoked is false\"] = jsonObject.revoked === false;",
                  "",
                  "pm.environment.set(\"secret_capability_token_read\", jsonObject.secret);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "c99d50c0-13a7-4b5a-a1f7-2389cbc16232",
                "exec": [
                  "pm.environment.set(\"description\", \"some description\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "d3e976fb-30d4-4679-8969-335037afeab0",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": {
                "token": "{{user1_token}}"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "title",
                  "type": "text",
                  "value": "{{description}}"
                },
                {
                  "key": "scope_type",
                  "type": "text",
                  "value": "album"
                },
                {
                  "key": "album",
                  "type": "text",
                  "value": "{{album_id_1}}"
                },
                {
                  "key": "read_permission",
                  "type": "text",
                  "value": "true"
                },
                {
                  "key": "write_permission",
                  "type": "text",
                  "value": "false"
                },
                {
                  "key": "appropriate_permission",
                  "type": "text",
                  "value": "false"
                },
                {
                  "key": "download_permission",
                  "type": "text",
                  "value": "false"
                }
              ]
            },
            "url": "{{URL}}/capabilities"
          },
          "response": []
        },
        {
          "name": "capability token read introspect",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
                "exec": [
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Active = true\"] = jsonObject.active === true;",
                  "tests[\"Scope = read\"] = jsonObject.scope.includes(\"read\") && jsonObject.scope.includes(\"write\") == false;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "58357ad4-d977-4634-bdbe-7cb45683148b",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "basic",
              "basic": {
                "password": "dicomwebproxyclientpassword",
                "username": "DICOMWebProxy"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "type": "text",
                  "value": "{{secret_capability_token_read}}"
                }
              ]
            },
            "url": "{{URL}}/token/introspect"
          },
          "response": []
        },
        {
          "name": "Create a capability token read (download appropriate)",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "31a1a60d-9293-4452-8e38-5f54a7c164db",
                "exec": [
                  "// ensure healthy response code",
                  "tests[\"Status code is 201\"] = responseCode.code === 201;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;",
                  "",
                  "tests[\"Not empty response []\"] = responseBody != \"[]\"",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"title\");",
                  "tests[\"Revoked is false\"] = jsonObject.revoked === false;",
                  "",
                  "pm.environment.set(\"secret_capability_token_read\", jsonObject.secret);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "c99d50c0-13a7-4b5a-a1f7-2389cbc16232",
                "exec": [
                  "pm.environment.set(\"description\", \"some description\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "51deb8ce-7919-47aa-a0a7-284912838541",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": {
                "token": "{{user1_token}}"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "title",
                  "type": "text",
                  "value": "{{description}}"
                },
                {
                  "key": "scope_type",
                  "type": "text",
                  "value": "album"
                },
                {
                  "key": "album",
                  "type": "text",
                  "value": "{{album_id_1}}"
                },
                {
                  "key": "read_permission",
                  "type": "text",
                  "value": "true"
                },
                {
                  "key": "write_permission",
                  "type": "text",
                  "value": "false"
                },
                {
                  "key": "appropriate_permission",
                  "type": "text",
                  "value": "true"
                },
                {
                  "key": "download_permission",
                  "type": "text",
                  "value": "true"
                }
              ]
            },
            "url": "{{URL}}/capabilities"
          },
          "response": []
        },
        {
          "name": "capability token read (download appropriate) introspect",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
                "exec": [
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Active = true\"] = jsonObject.active === true;",
                  "tests[\"Scope = read downloadbutton send\"] = jsonObject.scope.includes(\"read\") && jsonObject.scope.includes(\"downloadbutton\") && jsonObject.scope.includes(\"send\") && jsonObject.scope.includes(\"write\") == false;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "e94a132a-c626-416f-a133-c7b40536b98a",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "basic",
              "basic": {
                "password": "dicomwebproxyclientpassword",
                "username": "DICOMWebProxy"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "type": "text",
                  "value": "{{secret_capability_token_read}}"
                }
              ]
            },
            "url": "{{URL}}/token/introspect"
          },
          "response": []
        },
        {
          "name": "Create a capability token read write",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "31a1a60d-9293-4452-8e38-5f54a7c164db",
                "exec": [
                  "// ensure healthy response code",
                  "tests[\"Status code is 201\"] = responseCode.code === 201;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;",
                  "",
                  "tests[\"Not empty response []\"] = responseBody != \"[]\"",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"title\");",
                  "tests[\"Revoked is false\"] = jsonObject.revoked === false;",
                  "",
                  "pm.environment.set(\"secret_capability_token_read_write\", jsonObject.secret);",
                  "pm.environment.set(\"secret_capability_token_read_write_id\", jsonObject.id);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "c99d50c0-13a7-4b5a-a1f7-2389cbc16232",
                "exec": [
                  "pm.environment.set(\"description\", \"some description\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "4d42033f-33c4-46ab-8b25-5c631223f6ed",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": {
                "token": "{{user1_token}}"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "title",
                  "type": "text",
                  "value": "{{description}}"
                },
                {
                  "key": "scope_type",
                  "type": "text",
                  "value": "album"
                },
                {
                  "key": "album",
                  "type": "text",
                  "value": "{{album_id_1}}"
                },
                {
                  "key": "read_permission",
                  "type": "text",
                  "value": "true"
                },
                {
                  "key": "write_permission",
                  "type": "text",
                  "value": "true"
                },
                {
                  "key": "appropriate_permission",
                  "type": "text",
                  "value": "false"
                },
                {
                  "key": "download_permission",
                  "type": "text",
                  "value": "false"
                }
              ]
            },
            "url": "{{URL}}/capabilities"
          },
          "response": []
        },
        {
          "name": "capability token read write introspect",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
                "exec": [
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Active = true\"] = jsonObject.active === true;",
                  "tests[\"Scope = read write\"] = jsonObject.scope.includes(\"read\") && jsonObject.scope.includes(\"write\");",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "c7cdd678-85c0-4aa6-8693-60d52feac1c2",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "basic",
              "basic": {
                "password": "dicomwebproxyclientpassword",
                "username": "DICOMWebProxy"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "type": "text",
                  "value": "{{secret_capability_token_read_write}}"
                }
              ]
            },
            "url": "{{URL}}/token/introspect"
          },
          "response": []
        }
      ],
      "_postman_id": "42773c29-749f-44e5-a8c3-e700015887fd",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "a89f3378-fc2f-4cac-b4f7-96989cfd551c",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "6d148eb2-3c7c-4e2b-9d3f-438426f84df5",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "name": "Introspect revoked capability token",
      "item": [
        {
          "name": "Create an album(1)-OK",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "c09cfdaa-aa57-499c-a23c-8e26fa376e1e",
                "exec": [
                  "tests[\"Status code is 201\"] = responseCode.code === 201;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "pm.environment.set(\"album_id_1\", jsonObject.album_id);",
                  "",
                  "tests[\"album_id\"] = jsonObject.album_id == pm.environment.get(\"album_id_1\");",
                  "",
                  "tests[\"name\"] = jsonObject.name == \"name 1\"",
                  "",
                  "tests[\"description\"] = jsonObject.description == \"description 1\"",
                  "",
                  "tests[\"is_favorite\"] = jsonObject.is_favorite == false",
                  "",
                  "tests[\"number_of_users\"] = jsonObject.number_of_users == 1",
                  "",
                  "tests[\"number_of_comments\"] = jsonObject.number_of_comments == 0",
                  "",
                  "tests[\"number_of_studies\"] = jsonObject.number_of_studies == 0",
                  "",
                  "tests[\"add_user\"] = jsonObject.add_user == false",
                  "",
                  "tests[\"download_series\"] = jsonObject.download_series == true",
                  "",
                  "tests[\"send_series\"] = jsonObject.send_series == false",
                  "",
                  "tests[\"delete_series\"] = jsonObject.delete_series == false",
                  "",
                  "tests[\"add_series\"] = jsonObject.add_series == true",
                  "",
                  "tests[\"write_comments\"] = jsonObject.write_comments == true",
                  "",
                  "tests[\"notification_new_series\"] = jsonObject.notification_new_series == true",
                  "",
                  "tests[\"notification_new_comment\"] = jsonObject.notification_new_comment == true",
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "9779808a-2ba5-42f3-a7a1-2d91cb976010",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "9d50a285-d426-4fa5-9f09-dca248825045",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": {
                "token": "{{user1_token}}"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "sendSeries",
                  "value": "false",
                  "type": "text"
                },
                {
                  "key": "name",
                  "value": "name 1",
                  "type": "text"
                },
                {
                  "key": "description",
                  "value": "description 1",
                  "type": "text"
                }
              ]
            },
            "url": "{{URL}}/albums"
          },
          "response": []
        },
        {
          "name": "Create a capability token read write",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "31a1a60d-9293-4452-8e38-5f54a7c164db",
                "exec": [
                  "// ensure healthy response code",
                  "tests[\"Status code is 201\"] = responseCode.code === 201;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;",
                  "",
                  "tests[\"Not empty response []\"] = responseBody != \"[]\"",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"title\");",
                  "tests[\"Revoked is false\"] = jsonObject.revoked === false;",
                  "",
                  "pm.environment.set(\"secret_capability_token_read_write\", jsonObject.secret);",
                  "pm.environment.set(\"secret_capability_token_read_write_id\", jsonObject.id);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "c99d50c0-13a7-4b5a-a1f7-2389cbc16232",
                "exec": [
                  "pm.environment.set(\"description\", \"some description\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "214f121c-884f-4a26-9c40-3c1731a6dc8c",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": {
                "token": "{{user1_token}}"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "title",
                  "type": "text",
                  "value": "{{description}}"
                },
                {
                  "key": "scope_type",
                  "type": "text",
                  "value": "album"
                },
                {
                  "key": "album",
                  "type": "text",
                  "value": "{{album_id_1}}"
                },
                {
                  "key": "read_permission",
                  "type": "text",
                  "value": "true"
                },
                {
                  "key": "write_permission",
                  "type": "text",
                  "value": "true"
                },
                {
                  "key": "appropriate_permission",
                  "type": "text",
                  "value": "false"
                },
                {
                  "key": "download_permission",
                  "type": "text",
                  "value": "false"
                }
              ]
            },
            "url": "{{URL}}/capabilities"
          },
          "response": []
        },
        {
          "name": "Revoke capability token read write",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "31a1a60d-9293-4452-8e38-5f54a7c164db",
                "exec": [
                  "// ensure healthy response code",
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;",
                  "",
                  "tests[\"Not empty response []\"] = responseBody != \"[]\"",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"title\");",
                  "tests[\"Revoked is true\"] = jsonObject.revoked === true;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "c99d50c0-13a7-4b5a-a1f7-2389cbc16232",
                "exec": [
                  "pm.environment.set(\"description\", \"some description\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "33e11d54-3e45-4106-96ad-40d99e8e7d0d",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": {
                "token": "{{user1_token}}"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "url": "{{URL}}/capabilities/{{secret_capability_token_read_write_id}}/revoke"
          },
          "response": []
        },
        {
          "name": "capability token read write introspect-revoked",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
                "exec": [
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "const responseObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"active is false\"] = responseObject.active === false;",
                  "",
                  "tests[\"only one property\"] = Object.keys(responseObject).length === 1;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "59a97d44-9c7e-414e-bd89-8abad4ab5086",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "basic",
              "basic": {
                "password": "dicomwebproxyclientpassword",
                "username": "DICOMWebProxy"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "type": "text",
                  "value": "{{secret_capability_token_read_write}}"
                }
              ]
            },
            "url": "{{URL}}/token/introspect"
          },
          "response": []
        }
      ],
      "_postman_id": "92080316-d2f3-46bc-993a-8fccb77435c0"
    },
    {
      "name": "Introspect Viewer token",
      "item": [
        {
          "name": "STOW RS inside inbox user 1",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "7524252c-94ee-4cd1-8780-15785472765a",
                "exec": [
                  "// ensure healthy response code",
                  "tests[\"Status code is 200\"] = responseCode.code === 200;"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "0ac7c15d-7280-4194-8f70-d8bc2ddc6eb1",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": {
                "token": "{{user1_token}}"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "multipart/related; type=\"application/dicom\"; boundary=myboundary"
              }
            ],
            "body": {
              "mode": "file",
              "file": {}
            },
            "url": "{{URL}}/studies"
          },
          "response": []
        },
        {
          "name": "user1 get studies list-1 element",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "5ff53cd5-f3a8-4802-8eab-b6f709895551",
                "exec": [
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "let totalCount = parseInt(postman.getResponseHeader(\"X-Total-Count\"));",
                  "",
                  "if (totalCount === 1) {",
                  "    tests[\"X-Total-Count = 1\"] = true;",
                  "} else {",
                  "    tests[\"X-Total-Count = \" + totalCount + \" instead of 1\"] = false;",
                  "}",
                  "",
                  "tests[\"X-Total-Count exposed\"] = postman.getResponseHeader(\"Access-Control-Expose-Headers\").indexOf(\"X-Total-Count\") !== -1;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "4f41b5a2-2751-45af-aba5-a23c0c837907",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "04bdeb80-afcb-4664-9cea-0785a429caa3",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": {
                "token": "{{user1_token}}"
              }
            },
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/dicom+json"
              }
            ],
            "url": "{{URL}}/studies"
          },
          "response": []
        },
        {
          "name": "Create viewer token from access token",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
                "exec": [
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "//save the viewer token in an env var",
                  "pm.environment.set(\"viewer_token_user1\", jsonObject.access_token);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "118b82d6-0807-48e8-a770-196ab585330b",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "type": "text",
                  "value": "urn:ietf:params:oauth:grant-type:token-exchange"
                },
                {
                  "key": "subject_token",
                  "type": "text",
                  "value": "{{user1_token}}"
                },
                {
                  "key": "subject_token_type",
                  "type": "text",
                  "value": "urn:ietf:params:oauth:token-type:access_token"
                },
                {
                  "key": "scope",
                  "type": "text",
                  "value": "viewer"
                },
                {
                  "key": "studyUID",
                  "type": "text",
                  "value": "{{study_UID}}"
                },
                {
                  "key": "source_type",
                  "type": "text",
                  "value": "inbox"
                }
              ]
            },
            "url": "{{URL}}/token"
          },
          "response": []
        },
        {
          "name": "viewer token introspect",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
                "exec": [
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Active = true\"] = jsonObject.active === true;",
                  "tests[\"Scope = read\"] = jsonObject.scope.includes(\"read\") && jsonObject.scope.includes(\"write\") == false;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "6363a6f3-79da-4d05-bb82-26c4b0a126a0",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "basic",
              "basic": {
                "password": "dicomwebproxyclientpassword",
                "username": "DICOMWebProxy"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "type": "text",
                  "value": "{{viewer_token_user1}}"
                }
              ]
            },
            "url": "{{URL}}/token/introspect"
          },
          "response": []
        }
      ],
      "_postman_id": "b554405e-91a4-4eee-9650-016cd5da3ffe"
    },
    {
      "name": "Introspect pep token",
      "item": [
        {
          "name": "Create pep token from access token",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
                "exec": [
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "//save the pep token in an env var",
                  "pm.environment.set(\"pep_token_user1\", jsonObject.access_token);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "1be3fe85-8269-4712-afd9-1337de1944a3",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "basic",
              "basic": {
                "password": "dicomwebproxyclientpassword",
                "username": "DICOMWebProxy"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "type": "text",
                  "value": "urn:ietf:params:oauth:grant-type:token-exchange"
                },
                {
                  "key": "subject_token",
                  "type": "text",
                  "value": "{{user1_token}}"
                },
                {
                  "key": "subject_token_type",
                  "type": "text",
                  "value": "urn:ietf:params:oauth:token-type:access_token"
                },
                {
                  "key": "scope",
                  "type": "text",
                  "value": "pep"
                },
                {
                  "key": "studyUID",
                  "type": "text",
                  "value": "{{study_UID}}"
                },
                {
                  "key": "seriesUID",
                  "type": "text",
                  "value": "{{series_UID}}"
                }
              ]
            },
            "url": "{{URL}}/token"
          },
          "response": []
        },
        {
          "name": "pep token introspect",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
                "exec": [
                  "tests[\"Status code is 200\"] = responseCode.code === 200;",
                  "",
                  "var jsonObject = JSON.parse(responseBody);",
                  "",
                  "tests[\"Active = true\"] = jsonObject.active === true;",
                  "",
                  "tests[\"[INFO] Response: \" + responseBody] = true;"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "05792a38-6fc0-4b0d-bd00-aa0eed3235c3",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "basic",
              "basic": {
                "password": "dicomwebproxyclientpassword",
                "username": "DICOMWebProxy"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "type": "text",
                  "value": "{{pep_token_user1}}"
                }
              ]
            },
            "url": "{{URL}}/token/introspect"
          },
          "response": []
        }
      ],
      "_postman_id": "f706b53e-5cc3-4bea-96dc-5461141e396a"
    }
  ]
}