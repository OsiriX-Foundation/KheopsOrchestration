{
	"info": {
		"_postman_id": "39a3578b-2603-4741-9462-da4d3efd9ac8",
		"name": "kheops-DICOMweb_proxy",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Initialisation",
			"item": [
				{
					"name": "create user1-create",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "83822f04-38b7-400f-bc35-7a638a6d5e26",
								"type": "text/javascript",
								"exec": [
									"// ensure healthy response code",
									"tests[\"Status code is 201\"] = responseCode.code === 201;",
									"",
									"var jsonObject = JSON.parse(responseBody);",
									"",
									"pm.environment.set(\"access_token_user1\", jsonObject.access_token);"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
									"type": "text"
								},
								{
									"key": "assertion",
									"value": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjEifQ.eyJhdWQiOiJhdXRob3JpemF0aW9uLmtoZW9wcy5vbmxpbmUiLCJzdWIiOiIxMjM0NTY3ODkiLCJlbWFpbCI6InRvdG9AZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImV4cCI6MjUyMjk0MzU3MiwiaXNzIjoiYXV0aG9yaXphdGlvbi5raGVvcHMub25saW5lIiwiaWF0IjoxNTIyOTM5OTcyfQ.916Xn1BnUwdhOvuWErWWOh_AkYXeS36mVRTP06VWsVA",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{URL}}/token",
							"host": [
								"{{URL}}"
							],
							"path": [
								"token"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "STOW inbox",
			"item": [
				{
					"name": "STOW RS",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "7524252c-94ee-4cd1-8780-15785472765a",
								"type": "text/javascript",
								"exec": [
									"// ensure healthy response code",
									"tests[\"Status code is 200\"] = responseCode.code === 200;"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "multipart/related; type=\"application/dicom\"; boundary=myboundary"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token_user1}}"
							}
						],
						"body": {
							"mode": "file",
							"file": {}
						},
						"url": {
							"raw": "{{URL}}/studies",
							"host": [
								"{{URL}}"
							],
							"path": [
								"studies"
							]
						}
					},
					"response": []
				},
				{
					"name": "STOW RS-Unauthorized",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "7c6b5635-769a-474c-9995-b6ef6e1efc07",
								"type": "text/javascript",
								"exec": [
									"// ensure healthy response code",
									"tests[\"Status code is 401\"] = responseCode.code === 401;"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "multipart/related; type=\"application/dicom\"; boundary=myboundary"
							}
						],
						"body": {
							"mode": "file",
							"file": {}
						},
						"url": {
							"raw": "{{URL}}/studies",
							"host": [
								"{{URL}}"
							],
							"path": [
								"studies"
							]
						}
					},
					"response": []
				},
				{
					"name": "STOW RS series already exist",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "7524252c-94ee-4cd1-8780-15785472765a",
								"type": "text/javascript",
								"exec": [
									"// ensure healthy response code",
									"tests[\"Status code is 200\"] = responseCode.code === 200;",
									"",
									"tests[\"[INFO] Response: \" + responseBody] = true;"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "multipart/related; type=\"application/dicom\"; boundary=myboundary"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token_user1}}"
							}
						],
						"body": {
							"mode": "file",
							"file": {}
						},
						"url": {
							"raw": "{{URL}}/studies",
							"host": [
								"{{URL}}"
							],
							"path": [
								"studies"
							]
						}
					},
					"response": []
				},
				{
					"name": "user1 get studies list",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "a72f8b1c-898f-4cda-97d9-eb1a11636b72",
								"type": "text/javascript",
								"exec": [
									"tests[\"Status code is 200\"] = responseCode.code === 200;",
									"",
									"tests[\"Not empty response []\"] = responseBody != \"[]\"",
									"",
									"var jsonObject = JSON.parse(responseBody);",
									"",
									"tests[\"Return 1 study\"] = jsonObject.length === 1;",
									"",
									"tests[\"[INFO] Response: \" + responseBody] = true;"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "ec827ea4-26ee-4f3d-9b96-bf373cb9b0aa",
								"type": "text/javascript",
								"exec": [
									"function wait(ms)",
									"{",
									"    var d = new Date();",
									"    var d2 = null;",
									"    do { d2 = new Date(); }",
									"    while(d2-d < ms);",
									"}",
									"",
									"wait(5000);"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token_user1}}"
							}
						],
						"body": {},
						"url": {
							"raw": "{{URL}}/studies/?inbox",
							"host": [
								"{{URL}}"
							],
							"path": [
								"studies",
								""
							],
							"query": [
								{
									"key": "inbox",
									"value": null
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "STOW album",
			"item": [
				{
					"name": "Create an album(1)-OK",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "8a8b88a2-92e1-49c5-9a11-fd7956ea0823",
								"type": "text/javascript",
								"exec": [
									"tests[\"Status code is 201\"] = responseCode.code === 201;",
									"",
									"var jsonObject = JSON.parse(responseBody);",
									"",
									"pm.environment.set(\"album_id_1\", jsonObject.album_id);",
									"",
									"",
									"function wait(ms)",
									"{",
									"    var d = new Date();",
									"    var d2 = null;",
									"    do { d2 = new Date(); }",
									"    while(d2-d < ms);",
									"}",
									"",
									"wait(3000);"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "9779808a-2ba5-42f3-a7a1-2d91cb976010",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token_user1}}"
							},
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "sendSeries",
									"value": "false",
									"type": "text"
								},
								{
									"key": "name",
									"value": "name 1",
									"type": "text"
								},
								{
									"key": "description",
									"value": "description 1",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{URL}}/album",
							"host": [
								"{{URL}}"
							],
							"path": [
								"album"
							]
						}
					},
					"response": []
				},
				{
					"name": "STOW RS inside album",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "7524252c-94ee-4cd1-8780-15785472765a",
								"type": "text/javascript",
								"exec": [
									"// ensure healthy response code",
									"tests[\"Status code is 200\"] = responseCode.code === 200;"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "multipart/related; type=\"application/dicom\"; boundary=myboundary"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token_user1}}"
							}
						],
						"body": {
							"mode": "file",
							"file": {}
						},
						"url": {
							"raw": "{{URL}}/studies?album={{album_id_1}}",
							"host": [
								"{{URL}}"
							],
							"path": [
								"studies"
							],
							"query": [
								{
									"key": "album",
									"value": "{{album_id_1}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "album get studies list",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "128dde23-feee-4f1e-a16a-0f5249f5a7ec",
								"type": "text/javascript",
								"exec": [
									"tests[\"Status code is 200\"] = responseCode.code === 200;",
									"",
									"tests[\"Not empty response []\"] = responseBody != \"[]\"",
									"",
									"var jsonObject = JSON.parse(responseBody);",
									"",
									"tests[\"Return 1 study\"] = jsonObject.length === 1;",
									"",
									"tests[\"[INFO] Response: \" + responseBody] = true;"
								]
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "433061e1-5fc1-4ead-8d1d-c7aa6cd7c5f4",
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token_user1}}"
							}
						],
						"body": {},
						"url": {
							"raw": "{{URL}}/studies/?albums={{album_id_1}}",
							"host": [
								"{{URL}}"
							],
							"path": [
								"studies",
								""
							],
							"query": [
								{
									"key": "albums",
									"value": "{{album_id_1}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "STOW RS inside album same series",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "7524252c-94ee-4cd1-8780-15785472765a",
								"type": "text/javascript",
								"exec": [
									"// ensure healthy response code",
									"tests[\"Status code is 200\"] = responseCode.code === 200;"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "multipart/related; type=\"application/dicom\"; boundary=myboundary"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token_user1}}"
							}
						],
						"body": {
							"mode": "file",
							"file": {}
						},
						"url": {
							"raw": "{{URL}}/studies?album={{album_id_1}}",
							"host": [
								"{{URL}}"
							],
							"path": [
								"studies"
							],
							"query": [
								{
									"key": "album",
									"value": "{{album_id_1}}"
								}
							]
						}
					},
					"response": []
				}
			]
		}
	]
}
