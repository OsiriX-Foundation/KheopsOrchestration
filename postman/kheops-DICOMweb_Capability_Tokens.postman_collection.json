{
	"info": {
		"_postman_id": "4061eea2-205e-4f52-9615-912d545a09a4",
		"name": "kheops-DICOMweb_Capability_Tokens",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "create user1-OK",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "7d254f79-8603-4eab-9239-23ac1867331a",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 201\"] = responseCode.code === 201;",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"pm.environment.set(\"access_token_user1\", jsonObject.access_token);"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjEifQ.eyJhdWQiOiJhdXRob3JpemF0aW9uLmtoZW9wcy5vbmxpbmUiLCJzdWIiOiIxMjM0NTY3ODkiLCJlbWFpbCI6InRvdG9AZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImV4cCI6MjUyMjk0MzU3MiwiaXNzIjoiYXV0aG9yaXphdGlvbi5raGVvcHMub25saW5lIiwiaWF0IjoxNTIyOTM5OTcyfQ.916Xn1BnUwdhOvuWErWWOh_AkYXeS36mVRTP06VWsVA",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/token",
					"host": [
						"{{URL}}"
					],
					"path": [
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get a capability tokens user1-no token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "5ae678e6-d584-48e6-9a6f-d3b1956f85c1",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"tests[\"Empty response []\"] = responseBody === \"[]\""
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a capability tokens user1-OK",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "07de49d5-4292-43e1-b4d9-2666ac439fc0",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 201\"] = responseCode.code === 201;",
							"",
							"tests[\"Not empty response []\"] = responseBody != \"[]\"",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"description\");",
							"tests[\"Revoked is false\"] = jsonObject.revoked === false;",
							"",
							"",
							"pm.environment.set(\"secret_capability_token_id\", jsonObject.id);",
							"pm.environment.set(\"secret_capability_token\", jsonObject.secret);"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "c99d50c0-13a7-4b5a-a1f7-2389cbc16232",
						"type": "text/javascript",
						"exec": [
							"pm.environment.set(\"description\", \"some description\");"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					},
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "title",
							"value": "{{description}}",
							"type": "text"
						},
						{
							"key": "scope_type",
							"value": "user",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get a capability tokens user1-OK",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "779ff126-21f2-4e91-9a3d-57bbba046b94",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"tests[\"Not empty response []\"] = responseBody != \"[]\"",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"",
							"tests[\"Secrect is correct\"] = jsonObject[0].secret === pm.environment.get(\"secret_capability_token\");",
							"tests[\"Description is correct\"] = jsonObject[0].description === pm.environment.get(\"description\");"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "STOW with proxy RS-OK",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "7524252c-94ee-4cd1-8780-15785472765a",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "multipart/related; type=\"application/dicom\"; boundary=myboundary"
					}
				],
				"body": {
					"mode": "file",
					"file": {}
				},
				"url": {
					"raw": "{{URL}}/link/{{secret_capability_token}}/studies",
					"host": [
						"{{URL}}"
					],
					"path": [
						"link",
						"{{secret_capability_token}}",
						"studies"
					]
				}
			},
			"response": []
		},
		{
			"name": "user1 get studies list-1studie",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "a5055b06-d516-4117-b4f9-60329a2c6126",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"tests[\"Not empty response []\"] = responseBody != \"[]\"",
							"",
							"pm.environment.set(\"tempDicomData\", responseBody);"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "f20f2c04-9f39-4f84-8a01-0d8770a7ecc4",
						"type": "text/javascript",
						"exec": [
							"function wait(ms)",
							"{",
							"    var d = new Date();",
							"    var d2 = null;",
							"    do { d2 = new Date(); }",
							"    while(d2-d < ms);",
							"}",
							"",
							"wait(15000);"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					},
					{
						"key": "Accept",
						"value": "application/dicom+json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{URL}}/studies",
					"host": [
						"{{URL}}"
					],
					"path": [
						"studies"
					]
				}
			},
			"response": []
		},
		{
			"name": "STOW with proxy RS-Bad token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "b14b7732-6f86-408e-91c2-81d0546f12e6",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 401\"] = responseCode.code === 401;"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "multipart/related; type=\"application/dicom\"; boundary=myboundary"
					}
				],
				"body": {
					"mode": "file",
					"file": {}
				},
				"url": {
					"raw": "{{URL}}/link/9999999/studies",
					"host": [
						"{{URL}}"
					],
					"path": [
						"link",
						"9999999",
						"studies"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a capability tokens user1 with expiration date-OK",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "bba8cff6-16b9-48bc-98e2-ae189febdd3b",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 201\"] = responseCode.code === 201;",
							"",
							"tests[\"Not empty response []\"] = responseBody != \"[]\"",
							"",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"tests[\"Expiration date is correct\"] = jsonObject.expiration_date === pm.environment.get(\"expiration\");",
							"tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"description\");",
							"tests[\"Revoked is false\"] = jsonObject.revoked === false;",
							"",
							"",
							"pm.environment.unset(\"expiration\");"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "e3311fe8-b4f1-407e-a50e-5ec38e8fbcc0",
						"type": "text/javascript",
						"exec": [
							"pm.environment.set(\"expiration\", \"2019-12-01T08:35:50Z\");",
							"pm.environment.set(\"description\", \"some description 2\");"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					},
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "title",
							"value": "{{description}}",
							"type": "text"
						},
						{
							"key": "expiration",
							"value": "{{expiration}}",
							"type": "text"
						},
						{
							"key": "scope_type",
							"value": "user",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Revoke a capability tokens user1-OK",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "c5fb222e-0806-447f-b191-468d3d186c5f",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"tests[\"Not empty response []\"] = responseBody != \"[]\"",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"tests[\"Revoked is true\"] = jsonObject.revoked === true;"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{URL}}/capabilities/{{secret_capability_token_id}}/revoke",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities",
						"{{secret_capability_token_id}}",
						"revoke"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a capability tokens-Bad user1 access token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "55f24ad3-dde1-4bc3-9282-88b0a91ed3a1",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 401\"] = responseCode.code === 401;",
							""
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "709d4eb1-b23b-42ac-8132-153af2dc22a7",
						"type": "text/javascript",
						"exec": [
							"pm.environment.set(\"description\", \"some description\");"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer 9999999"
					},
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "title",
							"value": "{{description}}",
							"type": "text"
						},
						{
							"key": "scope_type",
							"value": "user",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a capability tokens-Bad expiration date",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "37b12a50-1b5f-4c5d-b085-f72e969c9c98",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 400\"] = responseCode.code === 400;"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "c89f916b-4bd1-4def-a504-75b7aa81cc80",
						"type": "text/javascript",
						"exec": [
							"pm.environment.set(\"description\", \"some description\");"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					},
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "title",
							"value": "{{description}}",
							"type": "text"
						},
						{
							"key": "expiration",
							"value": "1st mai 2018",
							"type": "text"
						},
						{
							"key": "scope_type",
							"value": "user",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a capability tokens-Bad expiration date (old date)",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "bc16fcb7-f6c9-4a7d-9eaf-247fadc0cdc8",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 201\"] = responseCode.code === 201;",
							"",
							"tests[\"Not empty response []\"] = responseBody != \"[]\"",
							"",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"tests[\"Expiration date is correct\"] = jsonObject.expiration_date === pm.environment.get(\"expiration\");",
							"tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"description\");",
							"tests[\"Revoked is false\"] = jsonObject.revoked === false;",
							"",
							"",
							"pm.environment.unset(\"expiration\");"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "df5fb1bb-a79b-4a21-880e-c0ac7bbeef16",
						"type": "text/javascript",
						"exec": [
							"pm.environment.set(\"expiration\", \"2015-12-01T08:35:50Z\");",
							"pm.environment.set(\"description\", \"some description 2\");"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					},
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "title",
							"value": "{{description}}",
							"type": "text"
						},
						{
							"key": "expiration",
							"value": "{{expiration}}",
							"type": "text"
						},
						{
							"key": "scope_type",
							"value": "user",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a capability tokens-Bad header accept",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "97d4a0d1-28c6-4a75-bb65-dca8a377901a",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 406\"] = responseCode.code === 406;"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "08d10ca2-3a65-4fff-85cc-b66f9c7ae8bc",
						"type": "text/javascript",
						"exec": [
							"pm.environment.set(\"description\", \"some description\");"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					},
					{
						"key": "Accept",
						"value": "application/json+dicom"
					},
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "title",
							"value": "{{description}}",
							"type": "text"
						},
						{
							"key": "scope_type",
							"value": "user",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a capability tokens-Empty description",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "9540db44-c1c4-4e54-9be7-14dad10a39b2",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 201\"] = responseCode.code === 201;",
							"",
							"tests[\"Not empty response []\"] = responseBody != \"[]\"",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"description\");",
							"tests[\"Revoked is false\"] = jsonObject.revoked === false;",
							"",
							"",
							"pm.environment.set(\"secret_capability_token\", jsonObject.secret);"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "bec3dcb0-f9a0-4f28-8b53-9cf1de3874c5",
						"type": "text/javascript",
						"exec": [
							"pm.environment.set(\"description\", \"\");"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					},
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "title",
							"value": "{{description}}",
							"type": "text"
						},
						{
							"key": "scope_type",
							"value": "user",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a capability tokens-Bad description",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "9540db44-c1c4-4e54-9be7-14dad10a39b2",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 201\"] = responseCode.code === 201;",
							"",
							"tests[\"Not empty response []\"] = responseBody != \"[]\"",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"description\");",
							"tests[\"Revoked is false\"] = jsonObject.revoked === false;",
							"",
							"",
							"pm.environment.set(\"secret_capability_token\", jsonObject.secret);"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "9a26a64b-3c3e-492a-83bc-eabde92455f0",
						"type": "text/javascript",
						"exec": [
							"pm.environment.set(\"description\", \"è¨éà$-.,_:;£äö!ü`^'^'0{}[]//\\\\<<>>  繁体字 / 繁體字, fántǐzì, \");"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					},
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "title",
							"value": "{{description}}",
							"type": "text"
						},
						{
							"key": "scope_type",
							"value": "user",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Get a capability tokens-Bad user1 access token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "1e0fa343-9a79-4987-b884-b712b6bd0c32",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 401\"] = responseCode.code === 401;"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer 9999999"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Create a capability tokens user1-OK (for next step)",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "44360ffc-dcfe-4475-95d2-f679d53359af",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 201\"] = responseCode.code === 201;",
							"",
							"tests[\"Not empty response []\"] = responseBody != \"[]\"",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"tests[\"Description is correct\"] = jsonObject.description === pm.environment.get(\"description\");",
							"tests[\"Revoked is false\"] = jsonObject.revoked === false;",
							"",
							"",
							"pm.environment.set(\"secret_capability_token\", jsonObject.secret);"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "c99d50c0-13a7-4b5a-a1f7-2389cbc16232",
						"type": "text/javascript",
						"exec": [
							"pm.environment.set(\"description\", \"some description\");"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					},
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "title",
							"value": "{{description}}",
							"type": "text"
						},
						{
							"key": "scope_type",
							"value": "user",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/capabilities",
					"host": [
						"{{URL}}"
					],
					"path": [
						"capabilities"
					]
				}
			},
			"response": []
		},
		{
			"name": "Request capability tokens-OK",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "54963654-bd26-4abe-ab25-b608f724ebff",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"tests[\"User is correct\"] = jsonObject.user === pm.globals.get(\"user1\");",
							"tests[\"token_type is \\\"Bearer\\\"\"] = jsonObject.token_type === \"Bearer\";",
							"",
							"pm.environment.set(\"capability_access_token_user1\", jsonObject.access_token);",
							"",
							""
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:x-kheops:params:oauth:grant-type:capability",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "{{secret_capability_token}}",
							"type": "text"
						},
						{
							"key": "return_user",
							"value": "true",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/token",
					"host": [
						"{{URL}}"
					],
					"path": [
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "Request capability tokens with scope-OK",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "54963654-bd26-4abe-ab25-b608f724ebff",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"tests[\"User is correct\"] = jsonObject.user === pm.globals.get(\"user1\");",
							"tests[\"token_type is \\\"Bearer\\\"\"] = jsonObject.token_type === \"Bearer\";",
							"",
							"pm.environment.set(\"capability_access_token_user1\", jsonObject.access_token);",
							"",
							""
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:x-kheops:params:oauth:grant-type:capability",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "{{secret_capability_token}}",
							"type": "text"
						},
						{
							"key": "scope",
							"value": "StudyInstanceUID={{study_UID}} SeriesInstanceUID={{series_UID}}",
							"type": "text"
						},
						{
							"key": "return_user",
							"value": "true",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/token",
					"host": [
						"{{URL}}"
					],
					"path": [
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "Request capability tokens-Bad scope",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "f14ac6cf-5e38-4c8f-9426-f3a68a23f3ff",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 400\"] = responseCode.code === 400;",
							""
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:x-kheops:params:oauth:grant-type:capability",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "{{secret_capability_token}}",
							"type": "text"
						},
						{
							"key": "scope",
							"value": "StudyInstanceUID={{study_UID}}123 SeriesInstanceUID={{series_UID}}456",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/token",
					"host": [
						"{{URL}}"
					],
					"path": [
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "Request capability tokens-Unknown capability token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "44aef2e6-7196-4070-9926-8e159fcba1b9",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 401\"] = responseCode.code === 401;"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:x-kheops:params:oauth:grant-type:capability",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "99999999",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/token",
					"host": [
						"{{URL}}"
					],
					"path": [
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "Request capability tokens-Unknown grant type",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "c0c20e4a-03c5-44f6-ab26-a3f133d51b76",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 400\"] = responseCode.code === 400;",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"tests[\"Unknown grant typen\"] = jsonObject.error_description === \"Unknown grant type: urn:x-kheops:params:oauth:grant-type:capabilityyyyy\";"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:x-kheops:params:oauth:grant-type:capabilityyyyy",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "{{secret_capability_token}}",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}/token",
					"host": [
						"{{URL}}"
					],
					"path": [
						"token"
					]
				}
			},
			"response": []
		}
	]
}