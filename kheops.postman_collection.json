{
	"info": {
		"_postman_id": "8477774e-a908-4fcc-a599-c74d55ff03ff",
		"name": "kheops",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "create user-Bad assertion",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "442edc98-b648-4a42-8533-57b1bc4df787",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 400\"] = responseCode.code === 400;",
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content_Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
							"description": "",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "123456789",
							"description": "",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}:8042/KheopsAuthorization/token",
					"host": [
						"{{URL}}"
					],
					"port": "8042",
					"path": [
						"KheopsAuthorization",
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "create user-Bad grant_type",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "024fc40a-0459-4f04-a716-1850369e15bd",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 400\"] = responseCode.code === 400;",
							""
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:ietf:params:oauth:grant-type:jwt-beare",
							"description": "",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "123456789",
							"description": "",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}:8042/KheopsAuthorization/token",
					"host": [
						"{{URL}}"
					],
					"port": "8042",
					"path": [
						"KheopsAuthorization",
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "create user1-create",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "2d502d26-5797-4180-b901-7230a32dfcaa",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 201\"] = responseCode.code === 201;",
							""
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
							"description": "",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjEifQ.eyJhdWQiOiJhdXRob3JpemF0aW9uLmtoZW9wcy5vbmxpbmUiLCJzdWIiOiIxMjM0NTY3ODkiLCJlbWFpbCI6InRvdG9AZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImV4cCI6MjUyMjk0MzU3MiwiaXNzIjoiYXV0aG9yaXphdGlvbi5raGVvcHMub25saW5lIiwiaWF0IjoxNTIyOTM5OTcyfQ.916Xn1BnUwdhOvuWErWWOh_AkYXeS36mVRTP06VWsVA",
							"description": "",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}:8042/KheopsAuthorization/token",
					"host": [
						"{{URL}}"
					],
					"port": "8042",
					"path": [
						"KheopsAuthorization",
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "create user1-OK",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "7d424a5e-5cda-49c1-a1f5-652755dbf16f",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"pm.environment.set(\"access_token_user1\", jsonObject.access_token);"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
							"description": "",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjEifQ.eyJhdWQiOiJhdXRob3JpemF0aW9uLmtoZW9wcy5vbmxpbmUiLCJzdWIiOiIxMjM0NTY3ODkiLCJlbWFpbCI6InRvdG9AZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImV4cCI6MjUyMjk0MzU3MiwiaXNzIjoiYXV0aG9yaXphdGlvbi5raGVvcHMub25saW5lIiwiaWF0IjoxNTIyOTM5OTcyfQ.916Xn1BnUwdhOvuWErWWOh_AkYXeS36mVRTP06VWsVA",
							"description": "",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}:8042/KheopsAuthorization/token",
					"host": [
						"{{URL}}"
					],
					"port": "8042",
					"path": [
						"KheopsAuthorization",
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "create user2-create",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "2d502d26-5797-4180-b901-7230a32dfcaa",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 201\"] = responseCode.code === 201;",
							""
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
							"description": "",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjEifQ.eyJhdWQiOiJhdXRob3JpemF0aW9uLmtoZW9wcy5vbmxpbmUiLCJzdWIiOiI5ODc2NTQzMjEiLCJlbWFpbCI6InRpdGlAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImV4cCI6MjUyMjk0MzU3MiwiaXNzIjoiYXV0aG9yaXphdGlvbi5raGVvcHMub25saW5lIiwiaWF0IjoxNTIyOTM5OTcyfQ.Csj6WCBDwZlXeUOE0nX6SmReZhGZayw2yZFKWzlwysE",
							"description": "",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}:8042/KheopsAuthorization/token",
					"host": [
						"{{URL}}"
					],
					"port": "8042",
					"path": [
						"KheopsAuthorization",
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "create user2-OK",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "49ce3e58-085d-4826-b75d-678695216dd9",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"var jsonObject = JSON.parse(responseBody);",
							"",
							"pm.environment.set(\"access_token_user2\", jsonObject.access_token);"
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "794cf6b5-3c58-4f4f-b14b-e1a551b617dc",
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/x-www-form-urlencoded"
					}
				],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "grant_type",
							"value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
							"description": "",
							"type": "text"
						},
						{
							"key": "assertion",
							"value": "eyJhbGciOiJIUzI1NiIsImtpZCI6IjEifQ.eyJhdWQiOiJhdXRob3JpemF0aW9uLmtoZW9wcy5vbmxpbmUiLCJzdWIiOiI5ODc2NTQzMjEiLCJlbWFpbCI6InRpdGlAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImV4cCI6MjUyMjk0MzU3MiwiaXNzIjoiYXV0aG9yaXphdGlvbi5raGVvcHMub25saW5lIiwiaWF0IjoxNTIyOTM5OTcyfQ.Csj6WCBDwZlXeUOE0nX6SmReZhGZayw2yZFKWzlwysE",
							"description": "",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{URL}}:8042/KheopsAuthorization/token",
					"host": [
						"{{URL}}"
					],
					"port": "8042",
					"path": [
						"KheopsAuthorization",
						"token"
					]
				}
			},
			"response": []
		},
		{
			"name": "user1 get studies list-Empty",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "828f735b-2926-4ab7-9ba2-968da5b9365d",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"tests[\"Empty response []\"] = responseBody === \"[]\""
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					}
				],
				"body": {},
				"url": {
					"raw": "{{URL}}:8042/KheopsAuthorization/users/{{user1}}/studies",
					"host": [
						"{{URL}}"
					],
					"port": "8042",
					"path": [
						"KheopsAuthorization",
						"users",
						"{{user1}}",
						"studies"
					]
				}
			},
			"response": []
		},
		{
			"name": "user1 get studies list-Bad access_token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "d27d678e-b913-4956-878f-4737b4424ded",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 401\"] = responseCode.code === 401;",
							""
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer 123456789"
					}
				],
				"body": {},
				"url": {
					"raw": "{{URL}}:8042/KheopsAuthorization/users/{{user1}}/studies",
					"host": [
						"{{URL}}"
					],
					"port": "8042",
					"path": [
						"KheopsAuthorization",
						"users",
						"{{user1}}",
						"studies"
					]
				}
			},
			"response": []
		},
		{
			"name": "user1 get studies list-Bad user",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "fe46f9d0-95f6-4e94-9658-d31ace21d97d",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 403\"] = responseCode.code === 403;"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					}
				],
				"body": {},
				"url": {
					"raw": "{{URL}}:8042/KheopsAuthorization/users/111/studies",
					"host": [
						"{{URL}}"
					],
					"port": "8042",
					"path": [
						"KheopsAuthorization",
						"users",
						"111",
						"studies"
					]
				}
			},
			"response": []
		},
		{
			"name": "dcm4chee STOW RS",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "7524252c-94ee-4cd1-8780-15785472765a",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;"
						]
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "multipart/related; type=\"application/dicom\"; boundary=myboundary"
					}
				],
				"body": {
					"mode": "file",
					"file": "testStudy.dcm"
				},
				"url": {
					"raw": "{{URL_PACS}}:8080/dcm4chee-arc/aets/DCM4CHEE/rs/studies",
					"host": [
						"{{URL_PACS}}"
					],
					"port": "8080",
					"path": [
						"dcm4chee-arc",
						"aets",
						"DCM4CHEE",
						"rs",
						"studies"
					]
				}
			},
			"response": []
		},
		{
			"name": "Give a user access to a specific series (first time)",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "910b5a1b-c53f-452d-b508-6170179cf2a3",
						"type": "text/javascript",
						"exec": [
							"tests[\"Status code is 201\"] = responseCode.code === 201;"
						]
					}
				}
			],
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					}
				],
				"body": {},
				"url": {
					"raw": "{{URL}}:8042/KheopsAuthorization/users/{{user1}}/studies/{{study_UID}}/series/{{series_UID}}",
					"host": [
						"{{URL}}"
					],
					"port": "8042",
					"path": [
						"KheopsAuthorization",
						"users",
						"{{user1}}",
						"studies",
						"{{study_UID}}",
						"series",
						"{{series_UID}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "user1 get studies list-1studie",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "828f735b-2926-4ab7-9ba2-968da5b9365d",
						"type": "text/javascript",
						"exec": [
							"// ensure healthy response code",
							"tests[\"Status code is 200\"] = responseCode.code === 200;",
							"",
							"tests[\"Empty response []\"] = responseBody === \"[]\""
						]
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"id": "310f0869-409b-444d-aadb-da282d0dc39f",
						"type": "text/javascript",
						"exec": [
							"function wait(ms)",
							"{",
							"    var d = new Date();",
							"    var d2 = null;",
							"    do { d2 = new Date(); }",
							"    while(d2-d < ms);",
							"}",
							"",
							"wait(15000);"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token_user1}}"
					}
				],
				"body": {},
				"url": {
					"raw": "{{URL}}:8042/KheopsAuthorization/users/{{user1}}/studies",
					"host": [
						"{{URL}}"
					],
					"port": "8042",
					"path": [
						"KheopsAuthorization",
						"users",
						"{{user1}}",
						"studies"
					]
				}
			},
			"response": []
		}
	]
}